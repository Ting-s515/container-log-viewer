# 測試用 Docker Compose
# 用途：模擬高頻/低頻日誌容器，測試切換容器時的競態條件修復
# docker compose -f docker-compose.test.yml up -d
# docker compose -f docker-compose.test.yml down

services:
  # 高頻日誌容器：每秒產生約 1000+ 行日誌
  high-freq-log:
    image: alpine:latest
    container_name: high-freq-log
    command: >
      sh -c "
        echo 'Starting high frequency log generator...';
        while true; do
          for i in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100; do
            echo \"$$(date '+%Y-%m-%d %H:%M:%S') [HIGH] Line $$i - Lorem ipsum dolor sit amet consectetur adipiscing elit\";
          done;
          sleep 0.1;
        done
      "
    restart: unless-stopped

  # 低頻日誌容器：每 2 秒產生 1 行日誌
  low-freq-log:
    image: alpine:latest
    container_name: low-freq-log
    command: >
      sh -c "
        echo 'Starting low frequency log generator...';
        counter=0;
        while true; do
          counter=$$((counter + 1));
          echo \"$$(date '+%Y-%m-%d %H:%M:%S') [LOW] Heartbeat #$$counter\";
          sleep 2;
        done
      "
    restart: unless-stopped
